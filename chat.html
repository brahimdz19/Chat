<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ ğŸ’¬</title>
  <style>
    * { box-sizing: border-box; font-family: "Cairo", sans-serif; }
    body {
      margin: 0; padding: 0;
      background: linear-gradient(135deg, #f0f0f0, #dcdcdc);
      display: flex; flex-direction: column;
      height: 100vh;
      transition: background 0.3s;
    }
    @media (prefers-color-scheme: dark) {
      body { background: #121212; color: white; }
      input, button { background: #1e1e1e; color: white; }
    }
    h2 {
      background: #0078ff; color: white; padding: 10px;
      text-align: center; margin: 0; font-size: 1.4em;
    }
    #messages {
      flex: 1; overflow-y: auto;
      padding: 10px;
      display: flex; flex-direction: column;
    }
    .msg {
      padding: 10px; margin: 6px;
      border-radius: 12px;
      max-width: 80%;
      word-wrap: break-word;
      animation: fadeIn 0.3s;
      font-size: 0.95em;
    }
    .mine {
      background: #0078ff; color: white;
      margin-left: auto; text-align: left;
    }
    .other {
      background: #e5e5ea; color: black;
      margin-right: auto; text-align: right;
    }
    .time {
      font-size: 0.7em; opacity: 0.7; float: left;
    }
    #inputArea {
      display: flex; padding: 8px;
      background: #f9f9f9; border-top: 1px solid #ccc;
      gap: 5px;
    }
    input {
      flex: 1; padding: 10px; border-radius: 10px;
      border: 1px solid #aaa; outline: none;
      font-size: 1em;
    }
    button {
      background: #0078ff; color: white; border: none;
      padding: 10px 12px; border-radius: 10px;
      cursor: pointer; transition: 0.3s;
      font-size: 1em;
    }
    button:hover { opacity: 0.85; }
    #clearChat { background: #ff5252; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Ø´Ø§Ø´Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø§Ø³Ù… */
    #nameScreen {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      color: white; z-index: 999;
    }
    #nameBox {
      background: white; color: black;
      padding: 20px; border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.3);
      text-align: center;
      width: 90%; max-width: 350px;
    }
    #nameBox input {
      width: 100%; padding: 10px;
      margin-top: 10px; border-radius: 8px;
      border: 1px solid #aaa; font-size: 1em;
    }
    #nameBox button {
      width: 100%; margin-top: 10px;
      background: #0078ff; color: white;
      border: none; padding: 10px;
      border-radius: 8px; cursor: pointer;
      font-size: 1em;
    }
    #nameBox button:hover { opacity: 0.9; }
  </style>
</head>

<body>
  <div id="nameScreen">
    <div id="nameBox">
      <h3>ğŸ‘‹ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ù„Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</h3>
      <input type="text" id="nameInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§..." />
      <button id="startChat">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</button>
    </div>
  </div>

  <h2>ğŸ’¬ Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</h2>
  <div id="messages"></div>
  <div id="inputArea">
    <input type="text" id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." />
    <button id="sendBtn">Ø¥Ø±Ø³Ø§Ù„</button>
    <button id="clearChat">ğŸ—‘ï¸</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    // ğŸ”¹ Ø¥Ø¹Ø¯Ø§Ø¯ Firebase Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
    const firebaseConfig = {
      apiKey: "AIzaSyCfbR_4l7CCvtoXANqg02ZIlVBM4PipqrI",
      authDomain: "chat-ca276.firebaseapp.com",
      databaseURL: "https://chat-ca276-default-rtdb.firebaseio.com",
      projectId: "chat-ca276",
      storageBucket: "chat-ca276.firebasestorage.app",
      messagingSenderId: "361228224911",
      appId: "1:361228224911:web:f6b02359574955814663fa"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const chatRef = ref(db, "messages");

    // ğŸ”¸ Ø§Ù„Ø¹Ù†Ø§ØµØ±
    const nameScreen = document.getElementById("nameScreen");
    const nameInput = document.getElementById("nameInput");
    const startChat = document.getElementById("startChat");
    const messagesDiv = document.getElementById("messages");
    const msgInput = document.getElementById("messageInput");
    const sendBtn = document.getElementById("sendBtn");
    const clearBtn = document.getElementById("clearChat");
    const audio = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_8b9b6b8cb3.mp3?filename=notification-113150.mp3");

    let userName = localStorage.getItem("chatUser");

    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ Ø§Ø³Ù…ØŒ Ø£Ø¸Ù‡Ø± Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
    if (!userName) {
      nameScreen.style.display = "flex";
    } else {
      nameScreen.style.display = "none";
    }

    // Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…
    startChat.onclick = () => {
      const name = nameInput.value.trim();
      if (name) {
        userName = name;
        localStorage.setItem("chatUser", name);
        nameScreen.style.display = "none";
      } else {
        alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…!");
      }
    };

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    function sendMessage() {
      const text = msgInput.value.trim();
      if (text === "" || !userName) return;
      const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      push(chatRef, { user: userName, text, time });
      msgInput.value = "";
    }

    sendBtn.onclick = sendMessage;
    msgInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") sendMessage();
    });

    // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    onChildAdded(chatRef, (data) => {
      const msg = data.val();
      const div = document.createElement("div");
      div.classList.add("msg", msg.user === userName ? "mine" : "other");
      div.innerHTML = `<b>${msg.user}</b> <span class="time">${msg.time}</span><br>${msg.text}`;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
      if (msg.user !== userName) audio.play();
    });

    // Ù…Ø³Ø­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
    clearBtn.onclick = () => {
      if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŸ")) {
        remove(chatRef);
        messagesDiv.innerHTML = "";
      }
    };
  </script>
</body>
</html>